<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MCQ Generator with Shareable Link</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem auto;
      max-width: 800px;
      padding: 20px;
    }
    textarea {
      width: 100%;
      height: 200px;
      padding: 10px;
      font-family: monospace;
    }
    button {
      padding: 10px 15px;
      margin: 10px 5px 0 0;
    }
    .question-block {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .question-block.correct {
      background-color: #e0ffe0;
    }
    .question-block.incorrect {
      background-color: #ffe0e0;
    }
    .choice {
      display: block;
      margin-bottom: 5px;
    }
    #quizContainer {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h1>MCQ Generator from Pasted Text</h1>

  <div id="inputSection">
    <p>Paste your questions below. Format like this:</p>
    <pre>
What is 2 + 2?
A. 3
*B. 4
C. 5
D. 6
    </pre>

    <textarea id="inputText" placeholder="Paste your questions here..."></textarea>
    <br/>
    <button onclick="generateMCQs()">Generate Questions</button>
  </div>

  <div id="editToggle" style="display:none;">
    <button onclick="showInput()">✏️ Edit Questions</button>
  </div>

  <div id="quizContainer"></div>
  <div id="shareLink" style="display:none;">
    <p>Share your quiz! Copy this link to share:</p>
    <input type="text" id="quizLink" readonly />
  </div>

  <script>
    let parsedQuestions = [];

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function generateMCQs() {
      const input = document.getElementById("inputText").value.trim();
      const rawQuestions = input.split(/\n\s*\n/); // split by blank lines
      parsedQuestions = [];

      rawQuestions.forEach(block => {
        const lines = block.split("\n").map(l => l.trim()).filter(Boolean);
        if (lines.length < 2) return;

        const questionText = lines[0];
        const choices = [];
        let correctIndex = -1;

        lines.slice(1).forEach((line, i) => {
          let text = line;
          if (line.startsWith("*")) {
            text = line.slice(1).trim();
            correctIndex = i;
          }
          choices.push(text);
        });

        parsedQuestions.push({ question: questionText, choices, correct: correctIndex });
      });

      // Shuffle questions
      parsedQuestions = shuffleArray(parsedQuestions);
      
      renderQuiz();
      
      // Hide input section, show edit button
      document.getElementById("inputSection").style.display = "none";
      document.getElementById("editToggle").style.display = "block";
      
      // Show shareable link
      generateShareableLink();
    }

    function showInput() {
      document.getElementById("inputSection").style.display = "block";
      document.getElementById("editToggle").style.display = "none";
      document.getElementById("quizContainer").innerHTML = "";
      document.getElementById("shareLink").style.display = "none";
    }

    function renderQuiz() {
      const quizContainer = document.getElementById("quizContainer");
      quizContainer.innerHTML = "";

      parsedQuestions.forEach((q, qIndex) => {
        const blockEl = document.createElement("div");
        blockEl.className = "question-block";
        blockEl.dataset.correct = q.correct;
        blockEl.dataset.index = qIndex;
        blockEl.innerHTML = `<strong>Q${qIndex + 1}: ${q.question}</strong><br/>`;

        q.choices.forEach((choice, cIndex) => {
          const inputId = `q${qIndex}c${cIndex}`;
          blockEl.innerHTML += `
            <label class="choice">
              <input type="radio" name="quiz${qIndex}" value="${cIndex}" id="${inputId}" />
              ${choice}
            </label>
          `;
        });

        quizContainer.appendChild(blockEl);
      });

      const checkAllBtn = document.createElement("button");
      checkAllBtn.textContent = "✅ Check All Answers";
      checkAllBtn.onclick = checkAllAnswers;
      quizContainer.appendChild(checkAllBtn);
    }

    function checkAllAnswers() {
      const blocks = document.querySelectorAll(".question-block");

      blocks.forEach(block => {
        const qIndex = block.dataset.index;
        const correct = parseInt(block.dataset.correct);
        const selected = document.querySelector(`input[name="quiz${qIndex}"]:checked`);

        block.classList.remove("correct", "incorrect");

        if (selected && parseInt(selected.value) === correct) {
          block.classList.add("correct");
        } else {
          block.classList.add("incorrect");
        }
      });
    }

    function generateShareableLink() {
      const urlData = JSON.stringify(parsedQuestions);
      const encodedData = encodeURIComponent(urlData);
      const link = `${window.location.href}?quiz=${encodedData}`;
      document.getElementById("quizLink").value = link;
      document.getElementById("shareLink").style.display = "block";
    }
  </script>

</body>
</html>
