<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Tr·∫Øc Nghi·ªám Generator</title>
  <style>
  body {
    font-family: Arial, sans-serif;
    max-width: 800px;
    margin: auto;
    padding: 20px;
    font-size: 16px;
  }
  textarea {
    width: 100%;
    height: 200px;
    padding: 10px;
    font-family: monospace;
    font-size: 1rem;
  }
  button {
    padding: 10px 15px;
    margin-top: 10px;
    font-size: 1rem;
    cursor: pointer;
  }
  .question-block {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }
  .question-block.correct {
    background-color: #e0ffe0;
  }
  .question-block.incorrect {
    background-color: #ffe0e0;
  }
  .choice {
    display: block;
    margin-bottom: 8px;
    font-size: 1.2rem;
    line-height: 1.6;
  }
  #quizContainer {
    margin-top: 30px;
  }
  @media (max-width: 600px) {
    body {
      font-size: 1.1rem;
    }
    .choice {
      font-size: 1.25rem;
    }
    textarea {
      font-size: 1rem;
    }
  }
</style>
</head>
<body>

  <h1>T·∫°o c√¢u h·ªèi tr·∫Øc nghi·ªám</h1>

  <div id="inputSection">
    <p>D√°n c√¢u h·ªèi c·ªßa b·∫°n v√†o b√™n d∆∞·ªõi. M·ªói c√¢u g·ªìm 1 d√≤ng c√¢u h·ªèi v√† 4 d√≤ng ƒë√°p √°n, v√≠ d·ª•:</p>
    <pre>
C√¢u h·ªèi v√≠ d·ª•?
A. ƒê√°p √°n 1
*B. ƒê√°p √°n ƒë√∫ng
C. ƒê√°p √°n 3
D. ƒê√°p √°n 4
    </pre>

    <textarea id="inputText" placeholder="D√°n c√°c c√¢u h·ªèi v√†o ƒë√¢y..."></textarea>
    <br/>
    <button onclick="generateMCQs()">T·∫°o c√¢u h·ªèi</button>
  </div>

  <div id="editToggle" style="display:none;">
    <button onclick="showInput()">‚úèÔ∏è Edit c√¢u h·ªèi</button>
  </div>

  <div id="quizContainer"></div>
  <div id="shareLink" style="display:none;">
    <p>üîó Chia s·∫ª b√†i tr·∫Øc nghi·ªám:</p>
    <input type="text" id="quizLink" readonly />
  </div>

  <script>
    let parsedQuestions = [];

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function generateMCQs() {
      const input = document.getElementById("inputText").value.trim();
      const rawQuestions = input.split(/\n\s*\n/); // t√°ch theo d√≤ng tr·ªëng
      parsedQuestions = [];

      rawQuestions.forEach(block => {
        const lines = block.split("\n").map(l => l.trim()).filter(Boolean);
        if (lines.length < 2) return;

        const questionText = lines[0];
        const choices = [];
        let correctIndex = -1;

        lines.slice(1).forEach((line, i) => {
          let text = line;
          if (line.startsWith("*")) {
            text = line.slice(1).trim();
            correctIndex = i;
          }
          choices.push(text);
        });

        parsedQuestions.push({ question: questionText, choices, correct: correctIndex });
      });

      parsedQuestions = shuffleArray(parsedQuestions);
      renderQuiz();
      document.getElementById("inputSection").style.display = "none";
      document.getElementById("editToggle").style.display = "block";
      generateShareableLink();
    }

    function showInput() {
      document.getElementById("inputSection").style.display = "block";
      document.getElementById("editToggle").style.display = "none";
      document.getElementById("quizContainer").innerHTML = "";
      document.getElementById("shareLink").style.display = "none";
    }

    function renderQuiz() {
      const quizContainer = document.getElementById("quizContainer");
      quizContainer.innerHTML = "";

      parsedQuestions.forEach((q, qIndex) => {
        const blockEl = document.createElement("div");
        blockEl.className = "question-block";
        blockEl.dataset.correct = q.correct;
        blockEl.dataset.index = qIndex;
        blockEl.innerHTML = `<p><strong>${q.question}</strong></p>`;

        q.choices.forEach((choice, cIndex) => {
          const inputId = `q${qIndex}c${cIndex}`;
          blockEl.innerHTML += `
            <label class="choice">
              <input type="radio" name="quiz${qIndex}" value="${cIndex}" id="${inputId}" />
              ${choice}
            </label>
          `;
        });

        quizContainer.appendChild(blockEl);
      });

      const checkAllBtn = document.createElement("button");
      checkAllBtn.textContent = "‚úÖ Ki·ªÉm tra";
      checkAllBtn.onclick = checkAllAnswers;
      quizContainer.appendChild(checkAllBtn);
    }

    function checkAllAnswers() {
      const blocks = document.querySelectorAll(".question-block");

      blocks.forEach(block => {
        const qIndex = block.dataset.index;
        const correct = parseInt(block.dataset.correct);
        const selected = document.querySelector(`input[name="quiz${qIndex}"]:checked`);

        block.classList.remove("correct", "incorrect");

        if (selected && parseInt(selected.value) === correct) {
          block.classList.add("correct");
        } else {
          block.classList.add("incorrect");
        }
      });
    }

    function generateShareableLink() {
      const urlData = JSON.stringify(parsedQuestions);
      const encodedData = encodeURIComponent(urlData);
      const link = `${window.location.origin}${window.location.pathname}?quiz=${encodedData}`;
      document.getElementById("quizLink").value = link;
      document.getElementById("shareLink").style.display = "block";
    }
  </script>

</body>
</html>
